<!DOCTYPE HTML>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<title>前端开发技术的发展</title>
</head>
<body>
<a href="http://johnqing.github.com" title="">返回首页</a>
<div class="post-text">
<h1>前端开发技术的发展</h1>

<p>Web开发技术，从狭义的定义来看，是指围绕HTML、JavaScript、CSS这样一套体系的开发技术，它的运行宿主是浏览器。从广义的定义来看，包括了：</p>

<ul>
<li>专门为手持终端设计的类似WML这样的类HTML语言，类似WMLScript这样的类JavaScript语言。</li>
<li>VML和SVG等基于XML的描述图形的语言。</li>
<li>从属于XML体系的XML，XPath，DTD等技术。</li>
<li>用于支撑后端的ASP，JSP，ASP.net，PHP，nodejs等语言或者技术。</li>
<li>被第三方程序打包的一种类似浏览器的宿主环境，比如Adobe AIR和使用HyBird方式的一些开发技术，如PhoneGap（它使用Android中的WebView等技术，让开发人员使用传统Web开发技术来开发本地应用）</li>
<li>Adobe Flash，Flex，Microsoft Silverlight，Java Applet，JavaFx等RIA开发技术。</li>
</ul>

<p>本文从狭义的Web定义出发，探讨一下这方面开发技术的发展过程。</p>

<p>从前端开发技术的发展来看，大致可以分为以下几个阶段：</p>

<h1>一. 刀耕火种</h1>

<h2>1. 静态页面</h2>

<p>最早期的Web界面基本都是在互联网上使用，人们浏览某些内容，填写几个表单，并且提交。当时的界面以浏览为主，基本都是HTML代码，有时候穿插一些JavaScript，作为客户端校验这样的基础功能。代码的组织比较简单，而且CSS的运用也是比较少的。</p>

<p>最简单的是这样一个文件：</p>

<pre class="prettyprint"><code><span class="tag">&lt;html&gt;</span><span class="pln">
    </span><span class="tag">&lt;head&gt;</span><span class="pln">
        </span><span class="tag">&lt;title&gt;</span><span class="pln">测试一</span><span class="tag">&lt;/title&gt;</span><span class="pln">
    </span><span class="tag">&lt;/head&gt;</span><span class="pln">
    </span><span class="tag">&lt;body&gt;</span><span class="pln">
        </span><span class="tag">&lt;h1&gt;</span><span class="pln">主标题</span><span class="tag">&lt;/h1&gt;</span><span class="pln">
        </span><span class="tag">&lt;p&gt;</span><span class="pln">段落内容</span><span class="tag">&lt;/p&gt;</span><span class="pln">
    </span><span class="tag">&lt;/body&gt;</span><span class="pln">
</span><span class="tag">&lt;/html&gt;</span></code></pre>

<h2>2. 带有简单逻辑的界面</h2>

<p>这个界面带有一段JavaScript代码，用于拼接两个输入框中的字符串，并且弹出窗口显示。</p>

<pre class="prettyprint"><code><span class="tag">&lt;html&gt;</span><span class="pln">
    </span><span class="tag">&lt;head&gt;</span><span class="pln">
        </span><span class="tag">&lt;title&gt;</span><span class="pln">测试二</span><span class="tag">&lt;/title&gt;</span><span class="pln">
    </span><span class="tag">&lt;/head&gt;</span><span class="pln">
    </span><span class="tag">&lt;body&gt;</span><span class="pln">
        </span><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"firstNameInput"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln"> 
        </span><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"lastNameInput"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln"> 
        </span><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"button"</span><span class="pln"> </span><span class="atn">onclick</span><span class="pun">=</span><span class="atv">"</span><span class="pln">greet</span><span class="pun">()</span><span class="atv">"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;script</span><span class="pln"> </span><span class="atn">language</span><span class="pun">=</span><span class="atv">"JavaScript"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="kwd">function</span><span class="pln"> greet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">var</span><span class="pln"> firstName </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">"firstNameInput"</span><span class="pun">).</span><span class="pln">value</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">var</span><span class="pln"> lastName </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">"lastNameInput"</span><span class="pun">).</span><span class="pln">value</span><span class="pun">;</span><span class="pln">
            alert</span><span class="pun">(</span><span class="str">"Hello, "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> firstName </span><span class="pun">+</span><span class="pln"> </span><span class="str">"."</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> lastName</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="tag">&lt;/script&gt;</span><span class="pln"> 
    </span><span class="tag">&lt;/body&gt;</span><span class="pln">
</span><span class="tag">&lt;/html&gt;</span></code></pre>

<h2>3. 结合了服务端技术的混合编程</h2>

<p>由于静态界面不能实现保存数据等功能，出现了很多服务端技术，早期的有CGI（Common Gateway Interface，多数用C语言或者Perl实现的），ASP（使用VBScript或者JavaScript），JSP（使用Java），PHP等等，Python和Ruby等语言也常被用于这类用途。</p>

<p>有了这类技术，在HTML中就可以使用表单的post功能提交数据了，比如：</p>

<pre class="prettyprint"><code><span class="tag">&lt;form</span><span class="pln"> </span><span class="atn">method</span><span class="pun">=</span><span class="atv">"post"</span><span class="pln"> </span><span class="atn">action</span><span class="pun">=</span><span class="atv">"username.asp"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;p&gt;</span><span class="pln">First Name: </span><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text"</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"firstName"</span><span class="pln"> </span><span class="tag">/&gt;&lt;/p&gt;</span><span class="pln">
    </span><span class="tag">&lt;p&gt;</span><span class="pln">Last Name: </span><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text"</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"lastName"</span><span class="pln"> </span><span class="tag">/&gt;&lt;/p&gt;</span><span class="pln">
    </span><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"submit"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"Submit"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;/form&gt;</span></code></pre>

<p>在这个阶段，由于客户端和服务端的职责未作明确的划分，比如生成一个字符串，可以由前端的JavaScript做，也可以由服务端语言做，所以通常在一个界面里，会有两种语言混杂在一起，用&lt;%和%&gt;标记的部分会在服务端执行，输出结果，甚至经常有把数据库连接的代码跟页面代码混杂在一起的情况，给维护带来较大的不便。</p>

<pre class="prettyprint"><code><span class="tag">&lt;html&gt;</span><span class="pln">
    </span><span class="tag">&lt;body&gt;</span><span class="pln">
        </span><span class="tag">&lt;p&gt;</span><span class="pln">Hello world!</span><span class="tag">&lt;/p&gt;</span><span class="pln">
        </span><span class="tag">&lt;p&gt;</span><span class="pln">
        </span><span class="pun">&lt;%</span><span class="pln">
            response</span><span class="pun">.</span><span class="pln">write</span><span class="pun">(</span><span class="str">"Hello world from server!"</span><span class="pun">)</span><span class="pln">
        %&gt;
        </span><span class="tag">&lt;/p&gt;</span><span class="pln">
    </span><span class="tag">&lt;/body&gt;</span><span class="pln">
</span><span class="tag">&lt;/html&gt;</span></code></pre>

<h2>4.组件化的萌芽</h2>

<p>这个时代，也逐渐出现了组件化的萌芽。比较常见的有服务端的组件化，比如把某一类服务端功能单独做成片段，然后其他需要的地方来include进来，典型的有：ASP里面数据库连接的地方，把数据源连接的部分写成conn.asp，然后其他每个需要操作数据库的asp文件包含它。</p>

<p>上面所说的是在服务端做的，浏览器端通常有针对JavaScript的，把某一类的Javascript代码写到单独的js文件中，界面根据需要，引用不同的js文件。针对界面的组件方式，通常利用frameset和iframe这两个标签。某一大块有独立功能的界面写到一个html文件，然后在主界面里面把它当作一个frame来载入，一般的B/S系统集成菜单的方式都是这样的。</p>

<p>此外，还出现了一些基于特定浏览器的客户端组件技术，比如IE浏览器的HTC（HTML Component）。这种技术最初是为了对已有的常用元素附加行为的，后来有些场合也用它来实现控件。微软ASP.net的一些版本里，使用这种技术提供了树形列表，日历，选项卡等功能。HTC的优点是允许用户自行扩展HTML标签，可以在自己的命名空间里定义元素，然后，使用HTML，JavaScript和CSS来实现它的布局、行为和观感。这种技术因为是微软的私有技术，所以逐渐变得不那么流行。</p>

<p>Firefox浏览器里面推出过一种叫XUL的技术，也没有流行起来。</p>

<h1>二. 铁器时代</h1>

<p>这个时代的典型特征是Ajax的出现。</p>

<h2>1. AJAX</h2>

<p>AJAX其实是一系列已有技术的组合，早在这个名词出现之前，这些技术的使用就已经比较广泛了，GMail因为恰当地应用了这些技术，获得了很好的用户体验。</p>

<p>由于Ajax的出现，规模更大，效果更好的Web程序逐渐出现，在这些程序中，JavaScript代码的数量迅速增加。出于代码组织的需要，“JavaScript框架”这个概念逐步形成，当时的主流是prototype和mootools，这两者各有千秋，提供了各自方式的面向对象组织思路。</p>

<h2>2. JavaScript基础库</h2>

<p>Prototype框架主要是为JavaScript代码提供了一种组织方式，对一些原生的JavaScript类型提供了一些扩展，比如数组、字符串，又额外提供了一些实用的数据结构，如：枚举，Hash等，除此之外，还对dom操作，事件，表单和Ajax做了一些封装。</p>

<p>Mootools框架的思路跟Prototype很接近，它对JavaScript类型扩展的方式别具一格，所以在这类框架中，经常被称作“最优雅的”对象扩展体系。</p>

<p>从这两个框架的所提供的功能来看，它们的定位是核心库，在使用的时候一般需要配合一些外围的库来完成。</p>

<p>jQuery与这两者有所不同，它着眼于简化DOM相关的代码。
例如：</p>

<ul>
<li>DOM的选择</li>
</ul>

<p>jQuery提供了一系列选择器用于选取界面元素，在其他一些框架中也有类似功能，但是一般没有它的简洁、强大。</p>

<pre class="prettyprint"><code><span class="pln">$</span><span class="pun">(</span><span class="str">"*"</span><span class="pun">)</span><span class="pln">              </span><span class="com">//选取所有元素</span><span class="pln">
$</span><span class="pun">(</span><span class="str">"#lastname"</span><span class="pun">)</span><span class="pln">      </span><span class="com">//选取id为lastname的元素</span><span class="pln">
$</span><span class="pun">(</span><span class="str">".intro"</span><span class="pun">)</span><span class="pln">         </span><span class="com">//选取所有class="intro"的元素</span><span class="pln">
$</span><span class="pun">(</span><span class="str">"p"</span><span class="pun">)</span><span class="pln">              </span><span class="com">//选取所有&amp;lt;p&amp;gt;元素</span><span class="pln">
$</span><span class="pun">(</span><span class="str">".intro.demo"</span><span class="pun">)</span><span class="pln">    </span><span class="com">//选取所有 class="intro"且class="demo"的元素</span></code></pre>

<ul>
<li>链式表达式：</li>
</ul>

<p>在jQuery中，可以使用链式表达式来连续操作dom，比如下面这个例子：</p>

<p>如果不使用链式表达式，可能我们需要这么写：</p>

<pre class="prettyprint"><code><span class="kwd">var</span><span class="pln"> neat </span><span class="pun">=</span><span class="pln"> $</span><span class="pun">(</span><span class="str">"p.neat"</span><span class="pun">);</span><span class="pln">
neat</span><span class="pun">.</span><span class="pln">addClass</span><span class="pun">(</span><span class="str">"ohmy"</span><span class="pun">);</span><span class="pln">
neat</span><span class="pun">.</span><span class="pln">show</span><span class="pun">(</span><span class="str">"slow"</span><span class="pun">);</span></code></pre>

<p>但是有了链式表达式，我们只需要这么一行代码就可以完成这些：</p>

<pre class="prettyprint"><code><span class="pln">$</span><span class="pun">(</span><span class="str">"p.neat"</span><span class="pun">).</span><span class="pln">addClass</span><span class="pun">(</span><span class="str">"ohmy"</span><span class="pun">).</span><span class="pln">show</span><span class="pun">(</span><span class="str">"slow"</span><span class="pun">);</span></code></pre>

<p>除此之外，jQuery还提供了一些动画方面的特效代码，也有大量的外围库，比如jQuery UI这样的控件库，jQuery mobile这样的移动开发库等等。</p>

<h2>3. 模块代码加载方式</h2>

<p>以上这些框架提供了代码的组织能力，但是未能提供代码的动态加载能力。动态加载JavaScript为什么重要呢？因为随着Ajax的普及，jQuery等辅助库的出现，Web上可以做很复杂的功能，因此，单页面应用程序（One Page One Application）也逐渐多了起来。</p>

<p>单个的界面想要做很多功能，需要写的代码是会比较多的，但是，并非所有的功能都需要在界面加载的时候就全部引入，如果能够在需要的时候才加载那些代码，就把加载的压力分担了，在这个背景下，出现了一些用于动态加载JavaScript的框架，也出现了一些定义这类可被动态加载代码的规范。</p>

<p>在这些框架里，知名度比较高的是RequireJS，它遵循一种称为AMD（Asynchronous Module Definition）的规范。</p>

<p>比如下面这段，定义了一个动态的匿名模块，它依赖math模块</p>

<pre class="prettyprint"><code><span class="pln">define</span><span class="pun">([</span><span class="str">"math"</span><span class="pun">],</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">math</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        addTen </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> math</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> </span><span class="lit">10</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">};</span><span class="pln">
</span><span class="pun">});</span><span class="pln"> </span></code></pre>

<p>假设上面的代码存放于adder.js中，当需要使用这个模块的时候，通过如下代码来引入adder：</p>

<pre class="prettyprint"><code><span class="tag">&lt;script</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"require.js"</span><span class="tag">&gt;&lt;/script&gt;</span><span class="pln">
</span><span class="tag">&lt;script&gt;</span><span class="pln">
    require</span><span class="pun">([</span><span class="str">"adder"</span><span class="pun">],</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">adder</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//使用这个adder</span><span class="pln">
    </span><span class="pun">});</span><span class="pln"> 
</span><span class="tag">&lt;/script&gt;</span></code></pre>

<p>RequireJS除了提供异步加载方式，也可以使用同步方式加载模块代码。AMD规范除了使用在前端浏览器环境中，也可以运行于nodejs等服务端环境，nodejs的模块就是基于这套规范定义的。</p>

<h1>三. 工业革命</h1>

<p>这个时期，随着Web端功能的日益复杂，人们开始考虑这样一些问题：</p>

<ul>
<li>如何更好地模块化开发</li>
<li>业务数据如何组织</li>
<li>界面和业务数据之间通过何种方式进行交互</li>
</ul>

<p>在这种背景下，出现了一些前端MVC、MVP、MVVM框架，我们把这些框架统称为MV*框架。这些框架的出现，都是为了解决上面这些问题，具体的实现思路各有不同，主流的有Backbone，AngularJS，Ember，Spine等等，本文主要选用Backbone和AngularJS来讲述以下场景。</p>

<h2>1. 数据模型</h2>

<p>在这些框架里，定义数据模型的方式与以往有些差异，主要在于数据的get和set更加有意义了，比如说，可以把某个实体的get和set绑定到RESTful的服务上，这样，对某个实体的读写可以更新到数据库中。另外一个特点是，它们一般都提供一个事件，用于监控数据的变化，这个机制使得数据绑定成为可能。</p>

<p>在一些框架中，数据模型需要在原生的JavaScript类型上做一层封装，比如Backbone的方式是这样：</p>

<pre class="prettyprint"><code><span class="kwd">var</span><span class="pln"> </span><span class="typ">Todo</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Backbone</span><span class="pun">.</span><span class="typ">Model</span><span class="pun">.</span><span class="pln">extend</span><span class="pun">({</span><span class="pln">
    </span><span class="com">// Default attributes for the todo item.</span><span class="pln">
    defaults </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            title </span><span class="pun">:</span><span class="pln"> </span><span class="str">"empty todo..."</span><span class="pun">,</span><span class="pln">
            order </span><span class="pun">:</span><span class="pln"> </span><span class="typ">Todos</span><span class="pun">.</span><span class="pln">nextOrder</span><span class="pun">(),</span><span class="pln">
            </span><span class="kwd">done</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">
        </span><span class="pun">};</span><span class="pln">
    </span><span class="pun">},</span><span class="pln">

    </span><span class="com">// Ensure that each todo created has `title`.</span><span class="pln">
    initialize </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">"title"</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">set</span><span class="pun">({</span><span class="pln">
                </span><span class="str">"title"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">defaults</span><span class="pun">().</span><span class="pln">title
            </span><span class="pun">});</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">},</span><span class="pln">

    </span><span class="com">// Toggle the 'done' state of this todo item.</span><span class="pln">
    toggle </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">save</span><span class="pun">({</span><span class="pln">
            </span><span class="kwd">done</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="pun">!</span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">"done"</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">});</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">});</span></code></pre>

<p>上述例子中，defaults方法用于提供模型的默认值，initialize方法用于做一些初始化工作，这两个都是约定的方法，toggle是自定义的，用于保存todo的选中状态。</p>

<p>除了对象，Backbone也支持集合类型，集合类型在定义的时候要通过model属性指定其中的元素类型。</p>

<pre class="prettyprint"><code><span class="com">// The collection of todos is backed by *localStorage* instead of a remote server.</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> </span><span class="typ">TodoList</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Backbone</span><span class="pun">.</span><span class="typ">Collection</span><span class="pun">.</span><span class="pln">extend</span><span class="pun">({</span><span class="pln">
    </span><span class="com">// Reference to this collection's model.</span><span class="pln">
    model </span><span class="pun">:</span><span class="pln"> </span><span class="typ">Todo</span><span class="pun">,</span><span class="pln">

    </span><span class="com">// Save all of the todo items under the '"todos-backbone"' namespace.</span><span class="pln">
    localStorage </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Backbone</span><span class="pun">.</span><span class="typ">LocalStorage</span><span class="pun">(</span><span class="str">"todos-backbone"</span><span class="pun">),</span><span class="pln">

    </span><span class="com">// Filter down the list of all todo items that are finished.</span><span class="pln">
    </span><span class="kwd">done</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">filter</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">todo</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> todo</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'done'</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">});</span><span class="pln">
    </span><span class="pun">},</span><span class="pln">

    </span><span class="com">// Filter down the list to only todo items that are still not finished.</span><span class="pln">
    remaining </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">without</span><span class="pun">.</span><span class="pln">apply</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">done</span><span class="pun">());</span><span class="pln">
    </span><span class="pun">},</span><span class="pln">

    </span><span class="com">// We keep the Todos in sequential order, despite being saved by unordered </span><span class="pln">
    </span><span class="com">//GUID in the database. This generates the next order number for new items.</span><span class="pln">
    nextOrder </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">length</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">last</span><span class="pun">().</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'order'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">},</span><span class="pln">

    </span><span class="com">// Todos are sorted by their original insertion order.</span><span class="pln">
    comparator </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">todo</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> todo</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'order'</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">});</span></code></pre>

<p>数据模型也可以包含一些方法，比如自身的校验，或者跟后端的通讯、数据的存取等等，在上面两个例子中，也都有体现。</p>

<p>AngularJS的模型定义方式与Backbone不同，可以不需要经过一层封装，直接使用原生的JavaScript简单数据、对象、数组，相对来说比较简便。</p>

<h2>2. 控制器</h2>

<p>在Backbone中，是没有独立的控制器的，它的一些控制的职责都放在了视图里，所以其实这是一种MVP（Model View Presentation）模式，而AngularJS有很清晰的控制器层。</p>

<p>还是以这个todo为例，在AngularJS中，会有一些约定的注入，比如$scope，它是控制器、模型和视图之间的桥梁。在控制器定义的时候，将$scope作为参数，然后，就可以在控制器里面为它添加模型的支持。</p>

<pre class="prettyprint"><code><span class="kwd">function</span><span class="pln"> </span><span class="typ">TodoCtrl</span><span class="pun">(</span><span class="pln">$scope</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    $scope</span><span class="pun">.</span><span class="pln">todos </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[{</span><span class="pln">
        text </span><span class="pun">:</span><span class="pln"> </span><span class="str">'learn angular'</span><span class="pun">,</span><span class="pln">
        </span><span class="kwd">done</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
    </span><span class="pun">},</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        text </span><span class="pun">:</span><span class="pln"> </span><span class="str">'build an angular app'</span><span class="pun">,</span><span class="pln">
        </span><span class="kwd">done</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">
    </span><span class="pun">}];</span><span class="pln">

    $scope</span><span class="pun">.</span><span class="pln">addTodo </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        $scope</span><span class="pun">.</span><span class="pln">todos</span><span class="pun">.</span><span class="pln">push</span><span class="pun">({</span><span class="pln">
            text </span><span class="pun">:</span><span class="pln"> $scope</span><span class="pun">.</span><span class="pln">todoText</span><span class="pun">,</span><span class="pln">
            </span><span class="kwd">done</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">
        </span><span class="pun">});</span><span class="pln">
        $scope</span><span class="pun">.</span><span class="pln">todoText </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">};</span><span class="pln">

    $scope</span><span class="pun">.</span><span class="pln">remaining </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">var</span><span class="pln"> count </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
        angular</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">(</span><span class="pln">$scope</span><span class="pun">.</span><span class="pln">todos</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">todo</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            count </span><span class="pun">+=</span><span class="pln"> todo</span><span class="pun">.</span><span class="kwd">done</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">});</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> count</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">};</span><span class="pln">

    $scope</span><span class="pun">.</span><span class="pln">archive </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">var</span><span class="pln"> oldTodos </span><span class="pun">=</span><span class="pln"> $scope</span><span class="pun">.</span><span class="pln">todos</span><span class="pun">;</span><span class="pln">
        $scope</span><span class="pun">.</span><span class="pln">todos </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span><span class="pln">
        angular</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">(</span><span class="pln">oldTodos</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">todo</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">todo</span><span class="pun">.</span><span class="kwd">done</span><span class="pun">)</span><span class="pln">
                $scope</span><span class="pun">.</span><span class="pln">todos</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">todo</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">});</span><span class="pln">
    </span><span class="pun">};</span><span class="pln">
</span><span class="pun">}</span></code></pre>

<p>本例中为$scope添加了todos这个数组，addTodo，remaining和archive三个方法，然后，可以在视图中对他们进行绑定。</p>

<h2>3. 视图</h2>

<p>在这些主流的MV*框架中，一般都提供了定义视图的功能。在Backbone中，是这样定义视图的：</p>

<pre class="prettyprint"><code><span class="com">// The DOM element for a todo item...</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> </span><span class="typ">TodoView</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Backbone</span><span class="pun">.</span><span class="typ">View</span><span class="pun">.</span><span class="pln">extend</span><span class="pun">({</span><span class="pln">
    </span><span class="com">//... is a list tag.</span><span class="pln">
    tagName </span><span class="pun">:</span><span class="pln"> </span><span class="str">"li"</span><span class="pun">,</span><span class="pln">

    </span><span class="com">// Cache the template function for a single item.</span><span class="pln">
    </span><span class="kwd">template</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> _</span><span class="pun">.</span><span class="kwd">template</span><span class="pun">(</span><span class="pln">$</span><span class="pun">(</span><span class="str">'#item-template'</span><span class="pun">).</span><span class="pln">html</span><span class="pun">()),</span><span class="pln">

    </span><span class="com">// The DOM events specific to an item.</span><span class="pln">
    events </span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="str">"click .toggle"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"toggleDone"</span><span class="pun">,</span><span class="pln">
        </span><span class="str">"dblclick .view"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"edit"</span><span class="pun">,</span><span class="pln">
        </span><span class="str">"click a.destroy"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"clear"</span><span class="pun">,</span><span class="pln">
        </span><span class="str">"keypress .edit"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"updateOnEnter"</span><span class="pun">,</span><span class="pln">
        </span><span class="str">"blur .edit"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"close"</span><span class="pln">
    </span><span class="pun">},</span><span class="pln">

    </span><span class="com">// The TodoView listens for changes to its model, re-rendering. Since there's</span><span class="pln">
    </span><span class="com">// a one-to-one correspondence between a **Todo** and a **TodoView** in this</span><span class="pln">
    </span><span class="com">// app, we set a direct reference on the model for convenience.</span><span class="pln">
    initialize </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">listenTo</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">model</span><span class="pun">,</span><span class="pln"> </span><span class="str">'change'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">render</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">listenTo</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">model</span><span class="pun">,</span><span class="pln"> </span><span class="str">'destroy'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">},</span><span class="pln">

    </span><span class="com">// Re-render the titles of the todo item.</span><span class="pln">
    render </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">$el</span><span class="pun">.</span><span class="pln">html</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">template</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">model</span><span class="pun">.</span><span class="pln">toJSON</span><span class="pun">()));</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">$el</span><span class="pun">.</span><span class="pln">toggleClass</span><span class="pun">(</span><span class="str">'done'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">model</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'done'</span><span class="pun">));</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">input </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">$</span><span class="pun">(</span><span class="str">'.edit'</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">},</span><span class="pln">

    </span><span class="com">//......</span><span class="pln">

    </span><span class="com">// Remove the item, destroy the model.</span><span class="pln">
    clear </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">model</span><span class="pun">.</span><span class="pln">destroy</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">});</span></code></pre>

<p>上面这个例子是一个典型的“部件”视图，它对于界面上的已有元素没有依赖。也有那么一些视图，需要依赖于界面上的已有元素，比如下面这个，它通过el属性，指定了HTML中id为todoapp的元素，并且还在initialize方法中引用了另外一些元素，通常，需要直接放置到界面的顶层试图会采用这种方式，而“部件”视图一般由主视图来创建、布局。</p>

<pre class="prettyprint"><code><span class="com">// Our overall **AppView** is the top-level piece of UI.</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> </span><span class="typ">AppView</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Backbone</span><span class="pun">.</span><span class="typ">View</span><span class="pun">.</span><span class="pln">extend</span><span class="pun">({</span><span class="pln">
    </span><span class="com">// Instead of generating a new element, bind to the existing skeleton of</span><span class="pln">
    </span><span class="com">// the App already present in the HTML.</span><span class="pln">
    el </span><span class="pun">:</span><span class="pln"> $</span><span class="pun">(</span><span class="str">"#todoapp"</span><span class="pun">),</span><span class="pln">

    </span><span class="com">// Our template for the line of statistics at the bottom of the app.</span><span class="pln">
    statsTemplate </span><span class="pun">:</span><span class="pln"> _</span><span class="pun">.</span><span class="kwd">template</span><span class="pun">(</span><span class="pln">$</span><span class="pun">(</span><span class="str">'#stats-template'</span><span class="pun">).</span><span class="pln">html</span><span class="pun">()),</span><span class="pln">

    </span><span class="com">// Delegated events for creating new items, and clearing completed ones.</span><span class="pln">
    events </span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="str">"keypress #new-todo"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"createOnEnter"</span><span class="pun">,</span><span class="pln">
        </span><span class="str">"click #clear-completed"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"clearCompleted"</span><span class="pun">,</span><span class="pln">
        </span><span class="str">"click #toggle-all"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"toggleAllComplete"</span><span class="pln">
    </span><span class="pun">},</span><span class="pln">

    </span><span class="com">// At initialization we bind to the relevant events on the `Todos`</span><span class="pln">
    </span><span class="com">// collection, when items are added or changed. Kick things off by</span><span class="pln">
    </span><span class="com">// loading any preexisting todos that might be saved in *localStorage*.</span><span class="pln">
    initialize </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">input </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">$</span><span class="pun">(</span><span class="str">"#new-todo"</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">allCheckbox </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">$</span><span class="pun">(</span><span class="str">"#toggle-all"</span><span class="pun">)[</span><span class="lit">0</span><span class="pun">];</span><span class="pln">

        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">listenTo</span><span class="pun">(</span><span class="typ">Todos</span><span class="pun">,</span><span class="pln"> </span><span class="str">'add'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">addOne</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">listenTo</span><span class="pun">(</span><span class="typ">Todos</span><span class="pun">,</span><span class="pln"> </span><span class="str">'reset'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">addAll</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">listenTo</span><span class="pun">(</span><span class="typ">Todos</span><span class="pun">,</span><span class="pln"> </span><span class="str">'all'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">render</span><span class="pun">);</span><span class="pln">

        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">footer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">$</span><span class="pun">(</span><span class="str">'footer'</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">main </span><span class="pun">=</span><span class="pln"> $</span><span class="pun">(</span><span class="str">'#main'</span><span class="pun">);</span><span class="pln">

        </span><span class="typ">Todos</span><span class="pun">.</span><span class="pln">fetch</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">},</span><span class="pln">

    </span><span class="com">// Re-rendering the App just means refreshing the statistics -- the rest</span><span class="pln">
    </span><span class="com">// of the app doesn't change.</span><span class="pln">
    render </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">var</span><span class="pln"> </span><span class="kwd">done</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Todos</span><span class="pun">.</span><span class="kwd">done</span><span class="pun">().</span><span class="pln">length</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">var</span><span class="pln"> remaining </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Todos</span><span class="pun">.</span><span class="pln">remaining</span><span class="pun">().</span><span class="pln">length</span><span class="pun">;</span><span class="pln">

        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Todos</span><span class="pun">.</span><span class="pln">length</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">main</span><span class="pun">.</span><span class="pln">show</span><span class="pun">();</span><span class="pln">
            </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">footer</span><span class="pun">.</span><span class="pln">show</span><span class="pun">();</span><span class="pln">
            </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">footer</span><span class="pun">.</span><span class="pln">html</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">statsTemplate</span><span class="pun">({</span><span class="pln">
                </span><span class="kwd">done</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">done</span><span class="pun">,</span><span class="pln">
                remaining </span><span class="pun">:</span><span class="pln"> remaining
            </span><span class="pun">}));</span><span class="pln">
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">main</span><span class="pun">.</span><span class="pln">hide</span><span class="pun">();</span><span class="pln">
            </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">footer</span><span class="pun">.</span><span class="pln">hide</span><span class="pun">();</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">allCheckbox</span><span class="pun">.</span><span class="kwd">checked</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">!</span><span class="pln">remaining</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">},</span><span class="pln">

    </span><span class="com">//......</span><span class="pln">
</span><span class="pun">});</span></code></pre>

<p>对于AngularJS来说，基本不需要有额外的视图定义，它采用的是直接定义在HTML上的方式，比如：</p>

<pre class="prettyprint"><code><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">ng-controller</span><span class="pun">=</span><span class="atv">"TodoCtrl"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;span&gt;</span><span class="pln">{{remaining()}} of {{todos.length}} remaining</span><span class="tag">&lt;/span&gt;</span><span class="pln">
    </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">""</span><span class="pln"> </span><span class="atn">ng-click</span><span class="pun">=</span><span class="atv">"archive()"</span><span class="tag">&gt;</span><span class="pln">archive</span><span class="tag">&lt;/a&gt;</span><span class="pln">
    </span><span class="tag">&lt;ul</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"unstyled"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;li</span><span class="pln"> </span><span class="atn">ng-repeat</span><span class="pun">=</span><span class="atv">"todo in todos"</span><span class="tag">&gt;</span><span class="pln">
            </span><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"checkbox"</span><span class="pln"> </span><span class="atn">ng-model</span><span class="pun">=</span><span class="atv">"todo.done"</span><span class="tag">&gt;</span><span class="pln">
            </span><span class="tag">&lt;span</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"done-{{todo.done}}"</span><span class="tag">&gt;</span><span class="pln">{{todo.text}}</span><span class="tag">&lt;/span&gt;</span><span class="pln">
        </span><span class="tag">&lt;/li&gt;</span><span class="pln">
    </span><span class="tag">&lt;/ul&gt;</span><span class="pln">
    </span><span class="tag">&lt;form</span><span class="pln"> </span><span class="atn">ng-submit</span><span class="pun">=</span><span class="atv">"addTodo()"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text"</span><span class="pln"> </span><span class="atn">ng-model</span><span class="pun">=</span><span class="atv">"todoText"</span><span class="pln">  </span><span class="atn">size</span><span class="pun">=</span><span class="atv">"30"</span><span class="pln">
        </span><span class="atn">placeholder</span><span class="pun">=</span><span class="atv">"add new todo here"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"btn-primary"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"submit"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"add"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;/form&gt;</span><span class="pln">
</span><span class="tag">&lt;/div&gt;</span></code></pre>

<p>在这个例子中，使用ng-controller注入了一个TodoCtrl的实例，然后，在TodoCtrl的$scope中附加的那些变量和方法都可以直接访问了。注意到其中的ng-repeat部分，它遍历了todos数组，然后使用其中的单个todo对象创建了一些HTML元素，把相应的值填到里面。这种做法和ng-model一样，都创造了双向绑定，即：</p>

<ul>
<li>改变模型可以随时反映到界面上</li>
<li>在界面上做的操作（输入，选择等等）可以实时反映到模型里。</li>
</ul>

<p>而且，这种绑定都会自动忽略其中可能因为空数据而引起的异常情况。</p>

<h2>4. 模板</h2>

<p>模板是这个时期一种很典型的解决方案。我们常常有这样的场景：在一个界面上重复展示类似的DOM片段，例如微博。以传统的开发方式，也可以轻松实现出来，比如：</p>

<pre class="prettyprint"><code><span class="kwd">var</span><span class="pln"> feedsDiv </span><span class="pun">=</span><span class="pln"> $</span><span class="pun">(</span><span class="str">"#feedsDiv"</span><span class="pun">);</span><span class="pln">

</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">5</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> feedDiv </span><span class="pun">=</span><span class="pln"> $</span><span class="pun">(</span><span class="str">"&lt;div class='post'&gt;&lt;/div&gt;"</span><span class="pun">);</span><span class="pln">

    </span><span class="kwd">var</span><span class="pln"> authorDiv </span><span class="pun">=</span><span class="pln"> $</span><span class="pun">(</span><span class="str">"&lt;div class='author'&gt;&lt;/div&gt;"</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> authorLink </span><span class="pun">=</span><span class="pln"> $</span><span class="pun">(</span><span class="str">"&lt;a&gt;&lt;/a&gt;"</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">attr</span><span class="pun">(</span><span class="str">"href"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"/user.html?user='"</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">"Test"</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">"'"</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">html</span><span class="pun">(</span><span class="str">"@"</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">"Test"</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">appendTo</span><span class="pun">(</span><span class="pln">authorDiv</span><span class="pun">);</span><span class="pln">
    authorDiv</span><span class="pun">.</span><span class="pln">appendTo</span><span class="pun">(</span><span class="pln">feedDiv</span><span class="pun">);</span><span class="pln">

    </span><span class="kwd">var</span><span class="pln"> contentDiv </span><span class="pun">=</span><span class="pln"> $</span><span class="pun">(</span><span class="str">"&lt;div&gt;&lt;/div&gt;"</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">html</span><span class="pun">(</span><span class="str">"Hello, world!"</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">appendTo</span><span class="pun">(</span><span class="pln">feedDiv</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> dateDiv </span><span class="pun">=</span><span class="pln"> $</span><span class="pun">(</span><span class="str">"&lt;div&gt;&lt;/div&gt;"</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">html</span><span class="pun">(</span><span class="str">"发布日期："</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">().</span><span class="pln">toString</span><span class="pun">())</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">appendTo</span><span class="pun">(</span><span class="pln">feedDiv</span><span class="pun">);</span><span class="pln">

    feedDiv</span><span class="pun">.</span><span class="pln">appendTo</span><span class="pun">(</span><span class="pln">feedsDiv</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>

<p>但是使用模板技术，这一切可以更加优雅，以常用的模板框架UnderScore为例，实现这段功能的代码为：</p>

<pre class="prettyprint"><code><span class="kwd">var</span><span class="pln"> templateStr </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;div class="post"&gt;'</span><span class="pln">
    </span><span class="pun">+</span><span class="str">'&lt;div class="author"&gt;'</span><span class="pln">
    </span><span class="pun">+</span><span class="pln">   </span><span class="str">'&lt;a href="/user.html?user={{creatorName}}"&gt;@{{creatorName}}&lt;/a&gt;'</span><span class="pln">
    </span><span class="pun">+</span><span class="str">'&lt;/div&gt;'</span><span class="pln">
    </span><span class="pun">+</span><span class="str">'&lt;div&gt;{{content}}&lt;/div&gt;'</span><span class="pln">
    </span><span class="pun">+</span><span class="str">'&lt;div&gt;{{postedDate}}&lt;/div&gt;'</span><span class="pln">
    </span><span class="pun">+</span><span class="str">'&lt;/div&gt;'</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> </span><span class="kwd">template</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> _</span><span class="pun">.</span><span class="kwd">template</span><span class="pun">(</span><span class="pln">templateStr</span><span class="pun">);</span><span class="pln">
</span><span class="kwd">template</span><span class="pun">({</span><span class="pln">
    createName </span><span class="pun">:</span><span class="pln"> </span><span class="str">"Xufei"</span><span class="pun">,</span><span class="pln">
    content</span><span class="pun">:</span><span class="pln"> </span><span class="str">"Hello, world"</span><span class="pun">,</span><span class="pln">
    postedDate</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">().</span><span class="pln">toString</span><span class="pun">()</span><span class="pln">
</span><span class="pun">});</span></code></pre>

<p>也可以这么定义：</p>

<pre class="prettyprint"><code><span class="tag">&lt;script</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text/template"</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"feedTemplate"</span><span class="tag">&gt;</span><span class="pln">
</span><span class="pun">&lt;%</span><span class="pln"> _</span><span class="pun">.</span><span class="pln">each</span><span class="pun">(</span><span class="pln">feeds</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">item</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">%&gt;</span><span class="pln">
    </span><span class="pun">&lt;</span><span class="pln">div </span><span class="kwd">class</span><span class="pun">=</span><span class="str">"post"</span><span class="pun">&gt;</span><span class="pln">
        </span><span class="pun">&lt;</span><span class="pln">div </span><span class="kwd">class</span><span class="pun">=</span><span class="str">"author"</span><span class="pun">&gt;</span><span class="pln">
            </span><span class="pun">&lt;</span><span class="pln">a href</span><span class="pun">=</span><span class="str">"/user.html?user=&lt;%= item.creatorName %&gt;"</span><span class="pun">&gt;@&lt;%=</span><span class="pln"> item</span><span class="pun">.</span><span class="pln">creatorName </span><span class="pun">%&gt;&lt;/</span><span class="pln">a</span><span class="pun">&gt;</span><span class="pln">
        </span><span class="pun">&lt;</span><span class="str">/div&gt;
        &lt;div&gt;&lt;%= item.content %&gt;&lt;/</span><span class="pln">div</span><span class="pun">&gt;</span><span class="pln">
        </span><span class="pun">&lt;</span><span class="pln">div</span><span class="pun">&gt;&lt;%=</span><span class="pln"> item</span><span class="pun">.</span><span class="pln">postedData </span><span class="pun">%&gt;&lt;/</span><span class="pln">div</span><span class="pun">&gt;</span><span class="pln">
    </span><span class="pun">&lt;/</span><span class="pln">div</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">&lt;%</span><span class="pln"> </span><span class="pun">});</span><span class="pln"> </span><span class="pun">%&gt;</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span><span class="pln">

</span><span class="tag">&lt;script&gt;</span><span class="pln">
$</span><span class="pun">(</span><span class="str">'#feedsDiv'</span><span class="pun">).</span><span class="pln">html</span><span class="pun">(</span><span class="pln"> _</span><span class="pun">.</span><span class="pln">template</span><span class="pun">(</span><span class="pln">$</span><span class="pun">(</span><span class="str">'#feedTemplate'</span><span class="pun">).</span><span class="pln">html</span><span class="pun">(),</span><span class="pln"> feeds</span><span class="pun">));</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span></code></pre>

<p>除此之外，UnderScore还提供了一些很方便的集合操作，使得模板的使用更加方便。如果你打算使用BackBone框架，并且需要用到模板功能，那么UnderScore是一个很好的选择，当然，也可以选用其它的模板库，比如Mustache等等。</p>

<p>如果使用AngularJS，可以不需要额外的模板库，它自身就提供了类似的功能，比如上面这个例子可以改写成这样：</p>

<pre class="prettyprint"><code><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"post"</span><span class="pln"> </span><span class="atn">ng-repeat</span><span class="pun">=</span><span class="atv">"post in feeds"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"author"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">ng-href</span><span class="pun">=</span><span class="atv">"/user.html?user={{post.creatorName}}"</span><span class="tag">&gt;</span><span class="pln">@{{post.creatorName}}</span><span class="tag">&lt;/a&gt;</span><span class="pln">
    </span><span class="tag">&lt;/div&gt;</span><span class="pln">
    </span><span class="tag">&lt;div&gt;</span><span class="pln">{{post.content}}</span><span class="tag">&lt;/div&gt;</span><span class="pln">
    </span><span class="tag">&lt;div&gt;</span><span class="pln">
        发布日期：{{post.postedTime | date:'medium'}}
    </span><span class="tag">&lt;/div&gt;</span><span class="pln">
</span><span class="tag">&lt;/div&gt;</span></code></pre>

<p>主流的模板技术都提供了一些特定的语法，有些功能很强。值得注意的是，他们虽然与JSP之类的代码写法类似甚至相同，但原理差别很大，这些模板框架都是在浏览器端执行的，不依赖任何服务端技术，即使界面文件是.html也可以，而传统比如JSP模板是需要后端支持的，执行时间是在服务端。</p>

<h2>5. 路由</h2>

<p>通常路由是定义在后端的，但是在这类MV*框架的帮助下，路由可以由前端来解析执行。比如下面这个Backbone的路由示例：</p>

<pre class="prettyprint"><code><span class="kwd">var</span><span class="pln"> </span><span class="typ">Workspace</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Backbone</span><span class="pun">.</span><span class="typ">Router</span><span class="pun">.</span><span class="pln">extend</span><span class="pun">({</span><span class="pln">
    routes</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="str">"help"</span><span class="pun">:</span><span class="pln">              </span><span class="str">"help"</span><span class="pun">,</span><span class="pln">    </span><span class="com">// #help</span><span class="pln">
        </span><span class="str">"search/:query"</span><span class="pun">:</span><span class="pln">        </span><span class="str">"search"</span><span class="pun">,</span><span class="pln">  </span><span class="com">// #search/kiwis</span><span class="pln">
        </span><span class="str">"search/:query/p:page"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"search"</span><span class="pln">   </span><span class="com">// #search/kiwis/p7</span><span class="pln">
    </span><span class="pun">},</span><span class="pln">

    help</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="pun">...</span><span class="pln">
    </span><span class="pun">},</span><span class="pln">

    search</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">query</span><span class="pun">,</span><span class="pln"> page</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="pun">...</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">   
</span><span class="pun">});</span></code></pre>

<p>在上述例子中，定义了一些路由的映射关系，那么，在实际访问的时候，如果在地址栏输入"#search/obama/p2"，就会匹配到"search/:query/p:page"这条路由，然后，把"obama"和"2"当作参数，传递给search方法。</p>

<p>AngularJS中定义路由的方式有些区别，它使用一个$routeProvider来提供路由的存取，每一个when表达式配置一条路由信息，otherwise配置默认路由，在配置路由的时候，可以指定一个额外的控制器，用于控制这条路由对应的html界面：</p>

<pre class="prettyprint"><code><span class="pln">app</span><span class="pun">.</span><span class="pln">config</span><span class="pun">([</span><span class="str">'$routeProvider'</span><span class="pun">,</span><span class="pln">
</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">$routeProvider</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    $routeProvider</span><span class="pun">.</span><span class="kwd">when</span><span class="pun">(</span><span class="str">'/phones'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        templateUrl </span><span class="pun">:</span><span class="pln"> </span><span class="str">'partials/phone-list.html'</span><span class="pun">,</span><span class="pln">
        controller </span><span class="pun">:</span><span class="pln"> </span><span class="typ">PhoneListCtrl</span><span class="pln">
    </span><span class="pun">}).</span><span class="kwd">when</span><span class="pun">(</span><span class="str">'/phones/:phoneId'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        templateUrl </span><span class="pun">:</span><span class="pln"> </span><span class="str">'partials/phone-detail.html'</span><span class="pun">,</span><span class="pln">
        controller </span><span class="pun">:</span><span class="pln"> </span><span class="typ">PhoneDetailCtrl</span><span class="pln">
    </span><span class="pun">}).</span><span class="pln">otherwise</span><span class="pun">({</span><span class="pln">
        redirectTo </span><span class="pun">:</span><span class="pln"> </span><span class="str">'/phones'</span><span class="pln">
    </span><span class="pun">});</span><span class="pln">
</span><span class="pun">}]);</span><span class="pln"> </span></code></pre>

<p>注意，在AngularJS中，路由的template并非一个完整的html文件，而是其中的一段，文件的头尾都可以不要，也可以不要那些包含的外部样式和JavaScript文件，这些在主界面中载入就可以了。</p>

<h2>6. 自定义标签</h2>

<p>用过XAML或者MXML的人一定会对其中的可扩充标签印象深刻，对于前端开发人员而言，基于标签的组件定义方式一定是优于其他任何方式的，看下面这段HTML：</p>

<pre class="prettyprint"><code><span class="tag">&lt;div&gt;</span><span class="pln">
    </span><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"hello, world"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;button&gt;</span><span class="pln">test</span><span class="tag">&lt;/button&gt;</span><span class="pln">
</span><span class="tag">&lt;/div&gt;</span></code></pre>

<p>即使是刚刚接触这种东西的新手，也能够理解它的意思，并且能够照着做出类似的东西，如果使用传统的面向对象语言去描述界面，效率远远没有这么高。</p>

<p>但是，HTML的标签是有限的，如果我们需要的功能不在其中，怎么办？在开发过程中，我们可能需要一个选项卡的功能，但是，HTML里面不提供选项卡标签，所以，一般来说，会使用一些li元素和div的组合，加上一些css，来实现选项卡的效果，也有的框架使用JavaScript来完成这些功能。总的来说，这些代码都不够简洁直观。</p>

<p>如果能够有一种技术，能够提供类似这样的方式，该多么好呢？</p>

<pre class="prettyprint"><code><span class="tag">&lt;tabs&gt;</span><span class="pln">
    </span><span class="tag">&lt;tab</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Tab 1"</span><span class="tag">&gt;</span><span class="pln">content 1</span><span class="tag">&lt;/tab&gt;</span><span class="pln">
    </span><span class="tag">&lt;tab</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Tab 2"</span><span class="tag">&gt;</span><span class="pln">content 2</span><span class="tag">&lt;/tab&gt;</span><span class="pln">
</span><span class="tag">&lt;/tabs&gt;</span></code></pre>

<p>回忆一下，我们在章节1.4 组件化的萌芽 里面，提到过一种叫做HTC的技术，这种技术提供了类似的功能，而且使用起来也比较简便，问题是，它属于一种正在消亡的技术，于是我们的目光投向了更为现代的前端世界，AngularJS拯救了我们。</p>

<p>在AngularJS的首页，可以看到这么一个区块“Create Components”，在它的演示代码里，能够看到类似的一段：</p>

<pre class="prettyprint"><code><span class="tag">&lt;tabs&gt;</span><span class="pln">
    </span><span class="tag">&lt;pane</span><span class="pln"> </span><span class="atn">title</span><span class="pun">=</span><span class="atv">"Localization"</span><span class="tag">&gt;</span><span class="pln">
        ...
    </span><span class="tag">&lt;/pane&gt;</span><span class="pln">
    </span><span class="tag">&lt;pane</span><span class="pln"> </span><span class="atn">title</span><span class="pun">=</span><span class="atv">"Pluralization"</span><span class="tag">&gt;</span><span class="pln">
        ...
    </span><span class="tag">&lt;/pane&gt;</span><span class="pln">
</span><span class="tag">&lt;/tabs&gt;</span></code></pre>

<p>那么，它是怎么做到的呢？秘密在这里：</p>

<pre class="prettyprint"><code><span class="pln">angular</span><span class="pun">.</span><span class="kwd">module</span><span class="pun">(</span><span class="str">'components'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[]).</span><span class="pln">directive</span><span class="pun">(</span><span class="str">'tabs'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        restrict </span><span class="pun">:</span><span class="pln"> </span><span class="str">'E'</span><span class="pun">,</span><span class="pln">
        transclude </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln">
        scope </span><span class="pun">:</span><span class="pln"> </span><span class="pun">{},</span><span class="pln">
        controller </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">$scope</span><span class="pun">,</span><span class="pln"> $element</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">var</span><span class="pln"> panes </span><span class="pun">=</span><span class="pln"> $scope</span><span class="pun">.</span><span class="pln">panes </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span><span class="pln">

            $scope</span><span class="pun">.</span><span class="kwd">select</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">pane</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                angular</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">(</span><span class="pln">panes</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">pane</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    pane</span><span class="pun">.</span><span class="pln">selected </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
                </span><span class="pun">});</span><span class="pln">
                pane</span><span class="pun">.</span><span class="pln">selected </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">

            </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">addPane </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">pane</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">panes</span><span class="pun">.</span><span class="pln">length </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
                    $scope</span><span class="pun">.</span><span class="kwd">select</span><span class="pun">(</span><span class="pln">pane</span><span class="pun">);</span><span class="pln">
                panes</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">pane</span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">},</span><span class="pln">
        </span><span class="kwd">template</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">'&lt;div class="tabbable"&gt;'</span><span class="pln">
            </span><span class="pun">+</span><span class="pln"> </span><span class="str">'&lt;ul class="nav nav-tabs"&gt;'</span><span class="pln"> 
            </span><span class="pun">+</span><span class="pln"> </span><span class="str">'&lt;li ng-repeat="pane in panes" ng-class="{active:pane.selected}"&gt;'</span><span class="pln"> 
            </span><span class="pun">+</span><span class="pln"> </span><span class="str">'&lt;a href="" ng-click="select(pane)"&gt;{{pane.title}}&lt;/a&gt;'</span><span class="pln"> 
            </span><span class="pun">+</span><span class="pln"> </span><span class="str">'&lt;/li&gt;'</span><span class="pln"> 
            </span><span class="pun">+</span><span class="pln"> </span><span class="str">'&lt;/ul&gt;'</span><span class="pln"> 
            </span><span class="pun">+</span><span class="pln"> </span><span class="str">'&lt;div class="tab-content" ng-transclude&gt;&lt;/div&gt;'</span><span class="pln"> 
            </span><span class="pun">+</span><span class="pln"> </span><span class="str">'&lt;/div&gt;'</span><span class="pun">,</span><span class="pln">
        replace </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
    </span><span class="pun">};</span><span class="pln">
</span><span class="pun">}).</span><span class="pln">directive</span><span class="pun">(</span><span class="str">'pane'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">require</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">'^tabs'</span><span class="pun">,</span><span class="pln">
        restrict </span><span class="pun">:</span><span class="pln"> </span><span class="str">'E'</span><span class="pun">,</span><span class="pln">
        transclude </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln">
        scope </span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            title </span><span class="pun">:</span><span class="pln"> </span><span class="str">'@'</span><span class="pln">
        </span><span class="pun">},</span><span class="pln">
        link </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">scope</span><span class="pun">,</span><span class="pln"> element</span><span class="pun">,</span><span class="pln"> attrs</span><span class="pun">,</span><span class="pln"> tabsCtrl</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            tabsCtrl</span><span class="pun">.</span><span class="pln">addPane</span><span class="pun">(</span><span class="pln">scope</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">},</span><span class="pln">
        </span><span class="kwd">template</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">'&lt;div class="tab-pane" ng-class="{active: selected}" ng-transclude&gt;'</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">'&lt;/div&gt;'</span><span class="pun">,</span><span class="pln">
        replace </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
    </span><span class="pun">};</span><span class="pln">
</span><span class="pun">})</span></code></pre>

<p>这段代码里，定义了tabs和pane两个标签，并且限定了pane标签不能脱离tabs而单独存在，tabs的controller定义了它的行为，两者的template定义了实际生成的html，通过这种方式，开发者可以扩展出自己需要的新元素，对于使用者而言，这不会增加任何额外的负担。</p>

<h1>四. 一些想说的话</h1>

<h3>关于ExtJS</h3>

<p>注意到在本文中，并未提及这样一个比较流行的前端框架，主要是因为他自成一系，思路跟其他框架不同，所做的事情，层次介于文中的二和三之间，所以没有单独列出。</p>

<h3>写作目的</h3>

<p>在我10多年的Web开发生涯中，经历了Web相关技术的各种变革，从2003年开始，接触并使用到了HTC，VML，XMLHTTP等当时比较先进的技术，目睹了网景浏览器的衰落，IE的后来居上，Firefox和Chrome的逆袭，各类RIA技术的风起云涌，对JavaScript的模块化有过持续的思考。未来究竟是什么样子？我说不清楚，只能凭自己的一些认识，把这些年一些比较主流的发展过程总结一下，供有需要了解的朋友们作个参考，错漏在所难免，欢迎大家指教。</p>

<p>个人邮箱：xu.fei@outlook.com<br>
新浪微博：http://weibo.com/sharpmaster</p>
                </div>
<strong>转自：http://www.ituring.com.cn/article/25069</strong>
</body>
</html>